

<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">Discover Amazing Miniatures</h1>
            <p class="hero-subtitle">From Warhammer 40K to historical battles,
                find your next painting project</p>
        </div>
    </div>
</div>

<!-- Advanced Filters Section -->
<div class="filters-section">
    <div class="container">
        <div class="filters-card">
            <div class="row g-3">
                <!-- Category Group Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Category Group</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedCategoryGroup"
                        (change)="onCategoryGroupChange()">
                        <option value>All Groups</option>
                        <option *ngFor="let group of categoryGroups"
                            [value]="group.id">
                            <i [class]="group.icon"></i> {{ group.name }}
                        </option>
                    </select>
                </div>

                <!-- Category Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Category</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedCategory"
                        (change)="debouncedFilter()"
                        [disabled]="!selectedCategoryGroup">
                        <option value>All Categories</option>
                        <option
                            *ngFor="let category of getCategoriesForGroup(selectedCategoryGroup)"
                            [value]="category.id">
                            {{ category.name }}
                        </option>
                    </select>
                </div>

                <!-- Scale Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Scale</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedScale"
                        (change)="debouncedFilter()">
                        <option value>All Scales</option>
                        <option *ngFor="let scale of filterOptions.scales"
                            [value]="scale">
                            {{ scale }}
                        </option>
                    </select>
                </div>

                <!-- Era Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Era</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedEra"
                        (change)="debouncedFilter()">
                        <option value>All Eras</option>
                        <option *ngFor="let era of filterOptions.eras"
                            [value]="era">
                            {{ era | titlecase }}
                        </option>
                    </select>
                </div>

                <!-- Condition Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Condition</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedCondition"
                        (change)="debouncedFilter()">
                        <option value>All Conditions</option>
                        <option
                            *ngFor="let condition of filterOptions.conditions"
                            [value]="condition">
                            {{ condition | titlecase }}
                        </option>
                    </select>
                </div>

                <!-- Status Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Status</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedStatus"
                        (change)="debouncedFilter()">
                        <option value>All Status</option>
                        <option value="active">Active</option>
                        <option value="ending-soon">Ending Soon</option>
                        <option value="ended">Ended</option>
                    </select>
                </div>

                <!-- Price Range Filter -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Price Range</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="selectedPriceRange"
                        (change)="debouncedFilter()">
                        <option value>All Prices</option>
                        <option *ngFor="let range of filterOptions.priceRanges"
                            [value]="range.id">
                            {{ range.label }}
                        </option>
                    </select>
                </div>

                <!-- Sort By -->
                <div class="col-lg-2 col-md-4 col-sm-6">
                    <label class="filter-label">Sort By</label>
                    <select class="form-select filter-select"
                        [(ngModel)]="sortBy"
                        (change)="debouncedFilter()">
                        <option value="newest">Newest First</option>
                        <option value="ending-soon">Ending Soon</option>
                        <option value="price-low-high">Price: Low to
                            High</option>
                        <option value="price-high-low">Price: High to
                            Low</option>
                        <option value="oldest">Oldest First</option>
                    </select>
                </div>

                <!-- My Auctions Checkbox -->
                <div class="col-lg-2 col-md-4 col-sm-6 d-flex align-items-end">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                            id="showOwnCheckbox"
                            [(ngModel)]="showOwn"
                            (change)="onShowOwnChange()"
                            [disabled]="!authService.isUserLoggedIn()">
                        <label class="form-check-label" for="showOwnCheckbox"
                            [class.text-muted]="!authService.isUserLoggedIn()">
                            <i class="fas fa-user me-1"></i>My Auctions
                            <small *ngIf="!authService.isUserLoggedIn()"
                                class="d-block text-muted">
                                (Login required)
                            </small>
                        </label>
                    </div>
                </div>

                <!-- Clear Filters Button -->
                <div class="col-lg-2 col-md-4 col-sm-6 d-flex align-items-end">
                    <button class="btn btn-outline-secondary w-100"
                        (click)="clearFilters()">
                        <i class="fas fa-times me-2"></i>Clear Filters
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Results Section -->
<div class="results-section">
    <div class="container p-0">
        <!-- Loading State -->
        @if (loading) {
        <div class="loading-state">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="loading-text">Discovering amazing miniatures...</p>
        </div>
        }
        <!-- Error State -->
        @if (error && !loading) {
        <div class="error-state">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="error-title">Oops! Something went wrong</h3>
            <p class="error-text">{{ errorMessage }}</p>
            <button class="btn btn-primary" (click)="loadAuctions()">
                <i class="fas fa-redo me-2"></i>Try Again
            </button>
        </div>
        }
        <!-- No Results State -->
        @if (!loading && !error && filteredAuctions.length === 0) {
        <div class="no-results-state">
            <div class="no-results-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3 class="no-results-title">No Miniatures Found</h3>
            <p class="no-results-text">Try adjusting your filters or browse all
                categories</p>
            <button class="btn btn-outline-primary" (click)="clearFilters()">
                <i class="fas fa-filter me-2"></i>Clear All Filters
            </button>
        </div>
        }

        <!-- Auctions Grid -->
        @if (!loading && filteredAuctions && filteredAuctions.length > 0) {
        <div class="auctions-grid">
            <div class="row g-4">
                <div *ngFor="let auction of filteredAuctions"
                    class="col-lg-3 col-md-4 col-sm-6">
                    <div class="auction-card">
                        <!-- Auction Image -->
                        <div class="auction-image">
                            <img [src]="auction.imageUrl" [alt]="auction.title"
                                class="img-fluid">
                            <div class="auction-status">
                                <span class="status-badge"
                                    [class]="getStatusClass(auction)">
                                    {{ getStatusText(auction) }}
                                </span>
                            </div>
                        </div>

                        <!-- Auction Content -->
                        <div class="auction-content">
                            <!-- Category Badge -->
                            <div class="category-badge">
                                <i
                                    *ngIf="getCategoryById(auction.category)?.icon"
                                    [class]="getCategoryById(auction.category)?.icon"
                                    class="me-1"></i>
                                {{ getCategoryDisplayName(auction.category) }}
                            </div>

                            <!-- Title -->
                            <h3 class="auction-title">
                                <a [routerLink]="['/auctions', auction.id]">{{
                                    auction.title }}</a>
                            </h3>

                            <!-- Description -->
                            <p class="auction-description">{{
                                auction.description }}</p>

                            <!-- Details -->
                            <div class="auction-details">
                                <div class="detail-row">
                                    <span class="detail-label">Scale:</span>
                                    <span class="detail-value">{{ auction.scale
                                        || 'Not specified' }}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Condition:</span>
                                    <span class="detail-value condition-badge"
                                        [class]="'condition-' + auction.condition">
                                        {{ auction.condition | titlecase }}
                                    </span>
                                </div>
                                <div class="detail-row" *ngIf="auction.era">
                                    <span class="detail-label">Era:</span>
                                    <span class="detail-value">{{ auction.era |
                                        titlecase }}</span>
                                </div>
                            </div>

                            <!-- Price & Bidding -->
                            <div class="auction-pricing">
                                <div class="current-price">
                                    <span class="price-label">Current
                                        Price:</span>
                                    <span class="price-amount">{{
                                        formatPrice(auction.currentPrice)
                                        }}</span>
                                </div>
                                <div class="bidding-info">
                                    <span class="bids-count">
                                        <i class="fas fa-gavel me-1"></i>
                                        {{ auction.bidCount || 0 }} bids
                                    </span>
                                    <span *ngIf="auction.endTime"
                                        class="end-time">
                                        <i class="fas fa-clock me-1"></i>
                                        {{ auction.endTime |
                                        date:'MMM d, h:mm a' }}
                                    </span>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="auction-actions">
                                <a [routerLink]="['/auctions', auction.id]"
                                    class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye me-1"></i>View Details
                                </a>
                                <button
                                    *ngIf="auction.saleType === 'direct' && auction.offers && auction.offers.length > 0"
                                    class="btn btn-outline-info btn-sm ms-2">
                                    <i class="fas fa-handshake me-1"></i>{{
                                    auction.offers.length }} Offers
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        }

        <!-- Pagination -->
        @if (!loading && !error && totalPages > 1) {
        <div class="pagination-section">
            <div class="container">
                <nav aria-label="Auctions pagination">
                    <ul class="pagination justify-content-center">
                        <!-- Previous Page -->
                        <li class="page-item"
                            [class.disabled]="currentPage === 1">
                            <button class="page-link"
                                (click)="goToPage(currentPage - 1)"
                                [disabled]="currentPage === 1">
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                        </li>

                        <!-- Page Numbers -->
                        @for (page of getPageNumbers(); track page) {
                        <li class="page-item"
                            [class.active]="page === currentPage">
                            <button class="page-link" (click)="goToPage(page)">
                                {{ page }}
                            </button>
                        </li>
                        }

                        <!-- Next Page -->
                        <li class="page-item"
                            [class.disabled]="currentPage === totalPages">
                            <button class="page-link"
                                (click)="goToPage(currentPage + 1)"
                                [disabled]="currentPage === totalPages">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </li>
                    </ul>
                </nav>

                <!-- Page Info -->
                <div class="text-center mt-3">
                    <small class="text-muted">
                        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{
                        Math.min(currentPage * itemsPerPage, totalAuctions) }}
                        of {{ totalAuctions }} auctions
                    </small>
                </div>
            </div>
        </div>
        }
    </div>
</div>